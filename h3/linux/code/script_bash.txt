#!/bin/bash
if [ $# -eq 0 ]
then
echo "Err: you should input log file path as argument"
else
nOfLines=$(cat $1 | awk ' END{print NR} ')
nOfGET=$(cat $1 | grep GET | awk ' END{print NR}')
nOfPOST=$(cat $1 | grep POST | awk ' END{print NR}')
nOfHEAD=$(cat $1 | grep HEAD | awk ' END{print NR}')
nOfPUT=$(cat $1 | grep PUT | awk ' END{print NR}')
nOfDELETE=$(cat $1 | grep DELETE | awk ' END{print NR}')
nOfCONNECT=$(cat $1 | grep CONNECT | awk ' END{print NR}')
nOfOPTIONS=$(cat $1 | grep OPTIONS | awk ' END{print NR}')
nOfTRACE=$(cat $1 | grep TRACE | awk ' END{print NR}')
nOfPATCH=$(cat $1 | grep PATCH | awk ' END{print NR}')
echo "Log contains: $nOfLines lines." > result.txt
echo "Number of requests:" >> result.txt
echo "GET - $nOfGET" >> result.txt
echo "POST - $nOfPOST" >> result.txt
echo "HEAD - $nOfHEAD" >> result.txt
echo "PUT - $nOfPUT" >> result.txt
echo "DELETE - $nOfDELETE" >> result.txt
echo "CONNECT - $nOfCONNECT" >> result.txt
echo "OPTIONS - $nOfOPTIONS" >> result.txt
echo "TRACE - $nOfTRACE" >> result.txt
echo "PATCH - $nOfPATCH" >> result.txt
echo "Top 10 by size:" >> result.txt
cat $1 | awk ' {print $1, $4, $5, $6, $7, $10}' | sort -nrk6 | head -10 >> result.txt
echo "Client errors:" >> result.txt
cat nginx.log | awk ' { if(($9>=400) && ($9<500)) {  print $1, $6, $7, $9, $10 }}' | sort -nrk5 | head -10 >> re$
echo "Redirects:" >> result.txt
cat nginx.log | awk ' { if(($9>=300) && ($9<400)) {  print $1, $6, $7, $9, $10 }}' | sort -nrk5 | head -10 >> re$
echo "End of script" >> result.txt
fi



